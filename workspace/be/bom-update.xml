<?xml version="1.0" encoding="UTF-8"?>
<!-- For any panel, the type determines the layout and class. The combination of 
      type and sub-type must be unique. If missing, the subtype is taken to be the
      same as the type. Within a panel, an artifact name/version combination must 
      be unique. 
      
      CAUTION: The version numbers here must coincide with versions in any site-specific
               installers.
 -->
<installer>
	<title>BatchExpert+</title>
	<description>Installer for ILS Automation's Batch Expert+</description>
	<property name="product">BatchExpert+</property>
	<property name="release">@RELEASE@</property>
	<property name="date">@DATE@</property>
	<property name="version">72</property>
	<!-- These entries define the install panels and their order -->
	<!-- The welcome panel must always be displayed, thus no version -->
	<panel type="welcome" essential="true">
		<title>ILS Automation Installer for Batch Expert+</title>
		<preamble>This is the ILS Automation update installer for Batch Expert+.
			It has been configured to update existing installations 
			to the latest version of Batch Expert+ on Ignition 8. 
			The table below compares the existing installed version of
			Batch Expert+ with the versions contained in this package. Before continuing, please make sure that you have 
			defined a data source and that it is configured to a schema version of at least
			Batch Expert+ 2.6. Note that, depending on your browser configuration, the release may be downloaded
			instead of displayed.
		</preamble>
		<artifact name="notes" type="pdf">
			<location>artifacts/doc/ReleaseNotes.pdf</location>
		</artifact>
	</panel>
	<!--  -->
	<panel type="file" essential="true" version="35">
		<title>Python Extensions for Batch Expert+</title>
		<preamble>This page loads the custom Python modules that support Batch Expert+. 
		</preamble>
		<artifact name="External Python for Batch Expert+" type="directory" subtype="user-lib">
			<location>artifacts/external/ils</location>
			<destination>pylib/ils</destination>
		</artifact>
		<artifact name="ILS jar files for Batch Expert+" type="directory" subtype="lib">
			<location>artifacts/external/lib</location>
			<destination>core/common</destination>
		</artifact>
		<artifact name="Custom SFC Steps for Batch Expert+" type="directory" subtype="user-lib">
			<location>artifacts/external/pysfc</location>
			<destination>pylib/ils/pysfc</destination>
		</artifact>
		<artifact name="XLSXWriter" type="directory" subtype="user-lib">
			<location>artifacts/external/xlsxwriter</location>
			<destination>pylib/xlsxwriter</destination>
		</artifact>
	</panel>
	<panel type="tag" subtype="production" essential="true" version="12">
		<title>Install UDT Definitions</title>
		<preamble>This page defines UDTs for common  controllers.
		           These definitions are written to the default tag provider.
		</preamble>
		<property name="provider" type="production">default</property>
		<property name="base" >[default]_types_</property>
		<artifact name="UDT Definitions" type="tag" subtype="json">
			<location>artifacts/tags/udts.json</location>
		</artifact>
	</panel>
	<panel type="definition" essential="true">
		<title>Define the Database Connections</title>
		<preamble>Specify the database connection and DBMS-type that 
		          are used for BatchExpert+.
		</preamble>
		<property name="database" type="production">
			<script>ils.be.configuration.config.setDatasource</script>
		</property>
		<property name="DBMS" type="production">
			<script>ils.be.configuration.config.setDBMS</script>
		</property>
		<property name="provider" type="production">default</property>
	</panel>

	<panel type="feature" essential="true">
		<title>Batch-Expert Feature Selection</title>
		<preamble>Configure the Batch-Expert+ installation to include the SFC and other optional features. Note that these
		          features are record as tag values. These decisions are, therefore, easily reversed. 
		</preamble>
		<!-- script defines python to execute on feature installation -->
		<artifact name="CAMPAIGN">
			<comment>Configure Batch Expert+ to add campaign as a parameter for batch tracking.</comment>
			<script>ils.be.configuration.config.setTrackBatchByCamapign</script>
		</artifact>
		<artifact name="CODE">
			<comment>Configure Batch Expert+ to add batch code as a parameter for batch tracking.</comment>
			<script>ils.be.configuration.config.setTrackBatchByCode</script>
		</artifact>
		<artifact name="CONDITION">
			<comment>Configure Batch Expert+ to add condition as a parameter for batch tracking.</comment>
			<script>ils.be.configuration.config.setTrackBatchByCondition</script>
		</artifact>
		<artifact name="CUSTOMER">
			<comment>Configure Batch Expert+ to add customer as a parameter for batch tracking.</comment>
			<script>ils.be.configuration.config.setTrackBatchByCustomer</script>
		</artifact>
		<artifact name="EFT">
			<comment>Configure Batch Expert+ to add auto EFT clearance as a feature.</comment>
			<script>ils.be.configuration.config.setAutoClearEFT</script>
		</artifact>
		<artifact name="EXPORT">
			<comment>Configure Batch Expert+ to show a customer export button on the batch browser.
			         See: BatchExpert/Configuration/batchExpertExportCustomLabel tag to change button text.</comment>
			<script>ils.be.configuration.config.setShowBatchBrowserCustomerExport</script>
		</artifact>
		<artifact name="FERMENTATION">
			<comment>Configure Batch Expert+ to add fermentation (organism) as a parameter for batch tracking.</comment>
			<script>ils.be.configuration.config.setTrackBatchByFermentation</script>
		</artifact>
		<artifact name="OWNER">
			<comment>Configure Batch Expert+ to add owner as a parameter for batch tracking.</comment>
			<script>ils.be.configuration.config.setTrackBatchByOwner</script>
		</artifact>
		<artifact name="PRODUCT">
			<comment>Configure Batch Expert+ to add product as a parameter for batch tracking.</comment>
			<script>ils.be.configuration.config.setTrackBatchByProject</script>
		</artifact>
		<artifact name="PROJECT">
			<comment>Configure Batch Expert+ to add project as a parameter for batch tracking.</comment>
			<script>ils.be.configuration.config.setTrackBatchByProduct</script>
		</artifact>
		<artifact name="RESOURCE">
			<comment>Configure Batch Expert+ to add resource as a parameter for batch tracking.</comment>
			<script>ils.be.configuration.config.setTrackBatchByResource</script>
		</artifact>
		<artifact name="SEED">
			<comment>Configure Batch Expert+ to add seed as a parameter for batch tracking.</comment>
			<script>ils.be.configuration.config.setTrackBatchBySeed</script>
		</artifact>
		<artifact name="SETUP">
			<comment>Configure Batch Expert+ to add setup as a parameter for batch tracking.</comment>
			<script>ils.be.configuration.config.setTrackBatchBySetup</script>
		</artifact>
		<artifact name="SFC">
			<comment>Enable Sequential Functional Charts (SFCs) within Batch-Expert. Use of this 
		         feature requires the Ignition SFC module and involves installation of a custom SFC module from ILS.</comment>
			<script>ils.be.configuration.config.setUseSFC</script>
		</artifact>
		<artifact name="STRAIN">
			<comment>Configure Batch Expert+ to add strain as a parameter for batch tracking.</comment>
			<script>ils.be.configuration.config.setTrackBatchByStrain</script>
		</artifact>
		<artifact name="VESSEL">
			<comment>Configure Batch Expert+ to add vessel id as a parameter for batch tracking.</comment>
			<script>ils.be.configuration.config.setTrackBatchByVessel</script>
		</artifact>
	</panel>
	<panel type="python" essential="true" version="13">
		<title>Alter Scripts for Batch Expert+</title>
		<preamble>This page updates the installed database schema to BatchExpert+ 3.1.
		</preamble>
		<artifact name="Alter Tables" type="alter">
			<script>ils.be.database.alter.alterDatabase()</script>
			<comment>Update table structures for the latest version of Batch Expert. No action is taken if the schema is current.</comment>
		</artifact>
	</panel>
	<panel type="scanclass" essential="true" version="2">
		<title>Create alternative Tag Groups</title>
		<preamble>Create tag groups referenced by application tags. 
				Tag groups determine tag poll rates.
		</preamble>
		<property name="project">BatchExpertMaster@RELEASE@</property>
		<artifact name="Production Tag Groups" type="scanclass" subtype="json">
			<location>artifacts/taggroups/tag-groups.json</location>
		</artifact>
	</panel>
	<panel type="module" subtype="production" essential="true" version="2" >
		<title>Update PySFC Module</title>
		<preamble>This step installed the ILS custom modules necessary for BatchExpert+
		          installations that include the SFC feature.
		</preamble>
		<property name="SFC" type="feature">TRUE</property>
		<artifact name="Python SFC" type="module">
			<location>artifacts/modules/pysfc-module-signed.modl</location>
		</artifact>
	</panel>
	<panel type="project" subtype="production" essential="true" version="1" >
		<title>Install PySFC project</title>
		<preamble>This step installs the PySFC project used to hold all PySFC instances.
					WARNING: Install this project only if the PySFC module was just installed
					for the first time into Ignition 8. If there is an existing PySFC project
					this step will perform a harmless merge.
		</preamble>
		<property name="SFC" type="feature">TRUE</property>
		<artifact name="Python SFC" type="project">
			<location>artifacts/projects/PySFC.zip</location>
		</artifact>
	</panel>
	<panel type="project" subtype="main" essential="true" version="37">
		<title>Install the BatchExpert+ Master Project
		</title>
		<preamble>BatchExpert+ is the main Ignition project. This page provides
			for an update to an existing project. The update alters only &quot;Master&quot; resources. It preserves any custom
			modifications which are stored in &quot;Site&quot; resources.
		</preamble>
		<!-- For projects, artifact subtypes are: full, partial and global
		     There can be at most one artifact of each type -->
		<artifact name="BatchExpertMaster@RELEASE@" type="project">
			<location>artifacts/projects/BatchExpertMaster.zip</location>
			<comment>Install the latest BatchExpert+ parent project (Master) 
					 into the existing gateway. </comment>
		</artifact>
	</panel>
	<panel type="documentation" essential="false">
		<title>Product Documentation</title>
		<preamble>In addition to the release notes, documentation includes a getting started guide.
		</preamble>
		<artifact name="Release Notes" type="documentation" subtype="pdf" release="@RELEASE@">
			<location>artifacts/doc/ReleaseNotes.pdf</location>
		</artifact>
		<artifact name="Getting Started Guide" type="documentation" subtype="docx" release="1.0">
			<location>artifacts/doc/BEGettingStarted.docx</location>
		</artifact>
	</panel>
	<!-- The summary panel must always be displayed, thus no version -->
	<panel type="summary" essential="true">
		<title>Installation Summary</title>
		<preamble>The list below shows which of the installation steps have been completed.
		 Selecting "Finish" will record the current version of Batch Expert+ in
			the Gateway internal database.
		</preamble>
	</panel>
	<!-- The completion page is displayed on finish. Use it to display post-install instructions. -->
	<epilog>
		<title>Installation Complete</title>
		<preamble>The automated installation and configuration of Batch Expert+
		          is complete. There are just a few more manual steps required. </preamble>
		<note name="Site Project">The site-specific project currently inherits from a prior version of the Master. Update it to refer to the newly installed Master.</note>
		<note name="Tag Groups">At this time tag groups are not handled by the installer. They must be imported manually from tag-groups.json. Find this file in the same location as you found the installer.</note>
		<note name="Gateway Restart">The tags have active components. A Gateway restart is required to accommodate the changes.</note>
	</epilog>
</installer>

